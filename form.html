<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Pembelian</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto my-10 bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold text-center mb-6">Form Pembelian</h1>
        
        <!-- Data Produk yang Dipilih -->
        <div class="border p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-2">Produk yang Dipilih</h2>
            <div class="flex items-center">
                <img id="productImage" src="" alt="Produk" class="w-24 h-24 object-cover rounded-lg">
                <div class="ml-4">
                    <h3 id="productName" class="text-lg font-bold"></h3>
                    <p id="productBrand" class="text-gray-600"></p>
                    <p id="productPrice" class="text-green-600 font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- Form Pembeli -->
        <form class="mt-6">
            <h2 class="text-lg font-semibold mb-2">Data Pembeli</h2>
            
            <div class="mb-4">
                <label class="block text-gray-700">Nama Lengkap</label>
                <input type="text" id="buyerName" class="w-full border p-2 rounded-lg" placeholder="Masukkan nama Anda" required>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700">Email</label>
                <input type="email" id="buyerEmail" class="w-full border p-2 rounded-lg" placeholder="Masukkan email Anda" required>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700">No. HP</label>
                <input type="tel" id="buyerPhone" class="w-full border p-2 rounded-lg" placeholder="Masukkan nomor HP Anda" required>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700">Provinsi</label>
                <select id="province" class="w-full border p-2 rounded-lg" required onchange="loadRegencies()">
                    <option value="">Pilih Provinsi</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700">Kabupaten/Kota</label>
                <select id="regency" class="w-full border p-2 rounded-lg" required onchange="loadDistricts()" disabled>
                    <option value="">Pilih Kabupaten/Kota</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700">Kecamatan</label>
                <select id="district" class="w-full border p-2 rounded-lg" required onchange="loadVillages()" disabled>
                    <option value="">Pilih Kecamatan</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700">Kelurahan/Desa</label>
                <select id="village" class="w-full border p-2 rounded-lg" required disabled>
                    <option value="">Pilih Kelurahan/Desa</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700">Detail Alamat</label>
                <textarea id="buyerAddress" class="w-full border p-2 rounded-lg" placeholder="Masukkan alamat lengkap Anda" required></textarea>
            </div>
            

            <!-- Input Jumlah Produk -->
            <div class="mb-4">
                <label class="block text-gray-700">Jumlah Produk</label>
                <input type="number" id="productQuantity" min="1" value="1" class="w-full border p-2 rounded-lg" required onchange="calculateTotal()">
            </div>

            <!-- Total Harga -->
            <div class="mb-4">
                <label class="block text-gray-700">Total Harga</label>
                <p id="totalPrice" class="text-xl font-bold text-green-600">Rp 0</p>
            </div>

            <!-- Tombol Konfirmasi Pembelian -->
            <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700">
                Konfirmasi Pembelian
            </button>
        </form>
    </div>

    <script>
        // Ambil parameter dari URL
        const urlParams = new URLSearchParams(window.location.search);
        const selectedProduct = urlParams.get("product");

        // Data produk (bisa diambil dari database atau API)
        const produkData = {
            "Pupuk NPK SANBLEND 15-15-15": { nama: "Pupuk NPK SANBLEND 15-15-15", merek: "SANBLEND", harga: 50000, gambar: "/static/img/produk/sanblend151515.png" },
            "Pupuk NPK SANBLEND 7-6-34": { nama: "Pupuk NPK SANBLEND 7-6-34", merek: "SANBLEND", harga: 50000, gambar: "/static/img/produk/sanblend7634.png" },
            "Pupuk NPK SANBLEND 12-12-17-2": { nama: "Pupuk NPK SANBLEND 12-12-17-2", merek: "SANBLEND", harga: 50000, gambar: "/static/img/produk/sanblend1212172.png" },
            "Pupuk NPK SANBLEND 13-6-27-4": { nama: "Pupuk NPK SANBLEND 13-6-27-4", merek: "SANBLEND", harga: 50000, gambar: "/static/img/produk/sanblend136274.png" },
            "Pupuk NPK MUTIARA 20-10-10": { nama: "Pupuk NPK MUTIARA 20-10-10", merek: "MUTIARA", harga: 60000, gambar: "/static/img/produk/mutiara201010.png" },
            "Pupuk NPK MUTIARA 9-25-25": { nama: "Pupuk NPK MUTIARA 9-25-25", merek: "MUTIARA", harga: 60000, gambar: "/static/img/produk/mutiara92525.png" },
            "Pupuk NPK MUTIARA 13-13-24": { nama: "Pupuk NPK MUTIARA 13-13-24", merek: "MUTIARA", harga: 60000, gambar: "/static/img/produk/mutiara131324.png" },
            "Pupuk NPK MUTIARA 16-16-16": { nama: "Pupuk NPK MUTIARA 16-16-16", merek: "MUTIARA", harga: 60000, gambar: "/static/img/produk/mutiara161616.png" },
            "Pupuk MEROKE CPN": { nama: "Pupuk MEROKE CPN", merek: "MEROKE", harga: 70000, gambar: "/static/img/produk/merokecpn.png" },
            "Pupuk MEROKE FOSFAT": { nama: "Pupuk MEROKE FOSFAT", merek: "MEROKE", harga: 70000, gambar: "/static/img/produk/merokefosfat.png" },
            "Pupuk MEROKE SOP": { nama: "Pupuk MEROKE SOP", merek: "MEROKE", harga: 70000, gambar: "/static/img/produk/merokesop.png" }
        };
    
        // Jika produk ditemukan dalam database, tampilkan datanya
        if (selectedProduct && produkData[selectedProduct]) {
            const produk = produkData[selectedProduct];
            document.getElementById("productImage").src = produk.gambar;
            document.getElementById("productName").textContent = produk.nama;
            document.getElementById("productBrand").textContent = `Merek: ${produk.merek}`;
            document.getElementById("productPrice").textContent = `Harga: Rp ${produk.harga.toLocaleString()}`;
            document.getElementById("totalPrice").textContent = `Rp ${produk.harga.toLocaleString()}`;

            // Simpan harga ke dalam variabel global untuk perhitungan jumlah produk
            window.productPrice = produk.harga;
        } else {
            alert("Produk tidak ditemukan!");
            window.location.href = "index.html"; // Redirect ke halaman utama jika produk tidak ditemukan
        }

        // Fungsi menghitung total harga berdasarkan jumlah produk
        function calculateTotal() {
            const quantity = parseInt(document.getElementById("productQuantity").value) || 1;
            const total = quantity * window.productPrice;
            document.getElementById("totalPrice").textContent = `Rp ${total.toLocaleString()}`;
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadProvinces();
        });
    
        function loadProvinces() {
            fetch("https://www.emsifa.com/api-wilayah-indonesia/api/provinces.json")
                .then(response => response.json())
                .then(provinces => {
                    let provinceSelect = document.getElementById("province");
                    provinces.forEach(province => {
                        let option = document.createElement("option");
                        option.value = province.id;
                        option.textContent = province.name;
                        provinceSelect.appendChild(option);
                    });
                });
        }
    
        function loadRegencies() {
            let provinceId = document.getElementById("province").value;
            let regencySelect = document.getElementById("regency");
            regencySelect.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';
            document.getElementById("district").innerHTML = '<option value="">Pilih Kecamatan</option>';
            document.getElementById("village").innerHTML = '<option value="">Pilih Kelurahan/Desa</option>';
            document.getElementById("district").disabled = true;
            document.getElementById("village").disabled = true;
    
            if (!provinceId) {
                regencySelect.disabled = true;
                return;
            }
    
            fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/regencies/${provinceId}.json`)
                .then(response => response.json())
                .then(regencies => {
                    regencySelect.disabled = false;
                    regencies.forEach(regency => {
                        let option = document.createElement("option");
                        option.value = regency.id;
                        option.textContent = regency.name;
                        regencySelect.appendChild(option);
                    });
                });
        }
    
        function loadDistricts() {
            let regencyId = document.getElementById("regency").value;
            let districtSelect = document.getElementById("district");
            districtSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
            document.getElementById("village").innerHTML = '<option value="">Pilih Kelurahan/Desa</option>';
            document.getElementById("village").disabled = true;
    
            if (!regencyId) {
                districtSelect.disabled = true;
                return;
            }
    
            fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/districts/${regencyId}.json`)
                .then(response => response.json())
                .then(districts => {
                    districtSelect.disabled = false;
                    districts.forEach(district => {
                        let option = document.createElement("option");
                        option.value = district.id;
                        option.textContent = district.name;
                        districtSelect.appendChild(option);
                    });
                });
        }
    
        function loadVillages() {
            let districtId = document.getElementById("district").value;
            let villageSelect = document.getElementById("village");
            villageSelect.innerHTML = '<option value="">Pilih Kelurahan/Desa</option>';
    
            if (!districtId) {
                villageSelect.disabled = true;
                return;
            }
    
            fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/villages/${districtId}.json`)
                .then(response => response.json())
                .then(villages => {
                    villageSelect.disabled = false;
                    villages.forEach(village => {
                        let option = document.createElement("option");
                        option.value = village.id;
                        option.textContent = village.name;
                        villageSelect.appendChild(option);
                    });
                });
        }
    </script>
    
</body>
</html>
